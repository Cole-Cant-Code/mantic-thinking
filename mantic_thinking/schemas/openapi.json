{
  "openapi": "3.0.0",
  "info": {
    "title": "Mantic Detection API",
    "version": "3.0.0",
    "description": "Deterministic cross-domain detection engine. One detect tool -- the LLM defines layers, weights, and values. The kernel handles the math."
  },
  "paths": {
    "/detect": {
      "post": {
        "summary": "Run Mantic detection on any domain. You define the layers, weights, and values.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["domain_name", "layer_names", "weights", "layer_values", "mode"],
                "properties": {
                  "domain_name": {
                    "type": "string",
                    "description": "Label for the domain you're analyzing"
                  },
                  "layer_names": {
                    "type": "array",
                    "items": {"type": "string"},
                    "minItems": 3,
                    "maxItems": 6,
                    "description": "3-6 layer name strings you define"
                  },
                  "weights": {
                    "type": "array",
                    "items": {"type": "number", "minimum": 0, "maximum": 1},
                    "minItems": 3,
                    "maxItems": 6,
                    "description": "Layer weights summing to 1.0. You decide importance."
                  },
                  "layer_values": {
                    "type": "array",
                    "items": {"type": "number", "minimum": 0, "maximum": 1},
                    "minItems": 3,
                    "maxItems": 6,
                    "description": "Layer input values (0-1). Your situational assessment."
                  },
                  "mode": {
                    "type": "string",
                    "enum": ["friction", "emergence"],
                    "description": "Detection mode: friction (divergence/risk) or emergence (alignment/opportunity)"
                  },
                  "detection_threshold": {
                    "type": "number",
                    "default": 0.4,
                    "description": "Threshold for detection (default 0.4)"
                  },
                  "layer_hierarchy": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "string",
                      "enum": ["Micro", "Meso", "Macro", "Meta"]
                    },
                    "description": "Optional mapping of layer names to hierarchy levels"
                  },
                  "f_time": {
                    "type": "number",
                    "default": 1.0,
                    "description": "Temporal multiplier (0.1-3.0)"
                  },
                  "threshold_override": {
                    "type": "object",
                    "description": "Optional per-threshold overrides (bounded +/-20% internally).",
                    "additionalProperties": {"type": "number"}
                  },
                  "temporal_config": {
                    "type": "object",
                    "description": "Optional temporal kernel config. Requires kernel_type and t.",
                    "properties": {
                      "kernel_type": {"type": "string"},
                      "alpha": {"type": "number"},
                      "n": {"type": "number"},
                      "t": {"type": "number"},
                      "t0": {"type": "number"},
                      "exponent": {"type": "number"},
                      "frequency": {"type": "number"},
                      "memory_strength": {"type": "number"}
                    }
                  },
                  "interaction_mode": {
                    "type": "string",
                    "enum": ["dynamic", "base"],
                    "default": "dynamic"
                  },
                  "interaction_override": {
                    "description": "Per-layer interaction coefficient overrides (0.1-2.0).",
                    "oneOf": [
                      {"type": "array", "items": {"type": "number"}},
                      {"type": "object", "additionalProperties": {"type": "number"}}
                    ]
                  },
                  "interaction_override_mode": {
                    "type": "string",
                    "enum": ["scale", "replace"],
                    "default": "scale"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Detection result",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "m_score": {"type": "number", "description": "Signal intensity"},
                    "spatial_component": {"type": "number", "description": "Spatial component (S)"},
                    "layer_attribution": {
                      "type": "object",
                      "additionalProperties": {"type": "number"},
                      "description": "Per-layer contribution percentages"
                    },
                    "layer_visibility": {
                      "type": "object",
                      "description": "Which hierarchy level dominates"
                    },
                    "layer_coupling": {
                      "type": "object",
                      "description": "Layer agreement/tension analysis"
                    },
                    "overrides_applied": {
                      "type": "object",
                      "description": "Audit trail of all overrides"
                    },
                    "alert": {
                      "type": "string",
                      "nullable": true,
                      "description": "Friction mode: alert message if divergence detected"
                    },
                    "severity": {
                      "type": "number",
                      "description": "Friction mode: severity score"
                    },
                    "window_detected": {
                      "type": "boolean",
                      "description": "Emergence mode: whether alignment window exists"
                    },
                    "window_type": {
                      "type": "string",
                      "description": "Emergence mode: type of window"
                    },
                    "confidence": {
                      "type": "number",
                      "description": "Emergence mode: confidence score"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
